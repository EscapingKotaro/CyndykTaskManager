{% extends 'tasks/base.html' %}

{% block content %}
<div class="card">
    <h2>üì® –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h2>
    <a href="{% url 'create_invitation' %}" class="btn btn-primary">‚ûï –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ</a>
</div>

<div class="card">
    <table class="table">
        <thead>
            <tr>
                <th>Email</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–°–æ–∑–¥–∞–Ω–æ</th>
                <th>–î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {% for inv in invitations %}
            <tr>
                <td>{{ inv.email }}</td>
                <td>
                    <span class="status-badge status-{{ inv.status }}">
                        {{ inv.get_status_display }}
                    </span>
                    {% if inv.accepted_by %}
                    <br><small>–ü—Ä–∏–Ω—è—Ç–æ: {{ inv.accepted_by.get_display_name }}</small>
                    {% endif %}
                </td>
                <td>{{ inv.created_at|date:"d.m.Y H:i" }}</td>
                <td>{{ inv.expires_at|date:"d.m.Y H:i" }}</td>
                <td>
                    {% if inv.status == 'pending' %}
                    <a href="#" class="btn btn-sm btn-outline" 
                       onclick="copyToClipboard('{{ request.scheme }}://{{ request.get_host }}{% url 'register_with_invitation' inv.token %}')">
                        üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
                    </a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(function() {
        alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
    });
}
</script>
{% endblock %}