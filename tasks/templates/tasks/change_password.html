{% extends 'tasks/base.html' %}

{% block title %}–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è - TaskManager{% endblock %}

{% block content %}
<div class="form-container">
    <div class="form-card">
        <div class="form-header">
            <h2>üîê –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è</h2>
            <p>–û–±–Ω–æ–≤–∏—Ç–µ –≤–∞—à –ø–∞—Ä–æ–ª—å –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∞–∫–∫–∞—É–Ω—Ç–∞</p>
        </div>

        <form method="post">
            {% csrf_token %}
            
            <div class="form-section">
                <h3>üîí –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ</h3>
                
                <div class="enhanced-input">
                    <label for="id_old_password">üîë –¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å</label>
                    <div class="input-wrapper">
                        <span class="icon">üîë</span>
                        <input type="password" name="old_password" id="id_old_password" 
                               class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å" required>
                    </div>
                    {% if form.old_password.errors %}
                    <div class="error">{{ form.old_password.errors }}</div>
                    {% endif %}
                </div>

                <div class="enhanced-input">
                    <label for="id_new_password1">üÜï –ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                    <div class="input-wrapper">
                        <span class="icon">üÜï</span>
                        <input type="password" name="new_password1" id="id_new_password1" 
                               class="form-control" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" required>
                    </div>
                    {% if form.new_password1.help_text %}
                    <div style="color: var(--secondary); font-size: 0.9rem; margin-top: 0.5rem;">
                        {{ form.new_password1.help_text }}
                    </div>
                    {% endif %}
                    {% if form.new_password1.errors %}
                    <div class="error">{{ form.new_password1.errors }}</div>
                    {% endif %}
                </div>

                <div class="enhanced-input">
                    <label for="id_new_password2">‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è</label>
                    <div class="input-wrapper">
                        <span class="icon">‚úÖ</span>
                        <input type="password" name="new_password2" id="id_new_password2" 
                               class="form-control" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" required>
                    </div>
                    {% if form.new_password2.errors %}
                    <div class="error">{{ form.new_password2.errors }}</div>
                    {% endif %}
                </div>
            </div>

            <div style="background: #fff3cd; border: 2px solid #ffeaa7; padding: 1.5rem; border-radius: 12px; margin: 2rem 0;">
                <h3 style="color: #856404; margin-bottom: 1rem;">üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø–∞—Ä–æ–ª—é</h3>
                <ul style="color: #856404; line-height: 1.6;">
                    <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–µ –º–µ–Ω–µ–µ 8 —Å–∏–º–≤–æ–ª–æ–≤</li>
                    <li>–î–æ–±–∞–≤—å—Ç–µ —Ü–∏—Ñ—Ä—ã –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã</li>
                    <li>–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ—Å—Ç—ã–µ –ø–∞—Ä–æ–ª–∏ (123456, password –∏ —Ç.–¥.)</li>
                    <li>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞—Ä–æ–ª–µ–π</li>
                </ul>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    üîê –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
                </button>
                <a href="{% url 'dashboard' %}" class="btn btn-secondary">
                    ‚Ü©Ô∏è –û—Ç–º–µ–Ω–∞
                </a>
            </div>
        </form>
    </div>
</div>

<style>
.password-strength {
    margin-top: 0.5rem;
    height: 4px;
    border-radius: 2px;
    background: #e2e8f0;
    overflow: hidden;
}

.strength-bar {
    height: 100%;
    transition: all 0.3s ease;
}

.strength-weak { background: #ef4444; width: 25%; }
.strength-medium { background: #f59e0b; width: 50%; }
.strength-strong { background: #10b981; width: 75%; }
.strength-very-strong { background: #059669; width: 100%; }

.strength-text {
    font-size: 0.8rem;
    margin-top: 0.3rem;
    font-weight: 600;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const passwordInput = document.getElementById('id_new_password1');
    const strengthBar = document.createElement('div');
    const strengthText = document.createElement('div');
    
    strengthBar.className = 'password-strength';
    strengthBar.innerHTML = '<div class="strength-bar"></div>';
    strengthText.className = 'strength-text';
    
    passwordInput.parentNode.appendChild(strengthBar);
    passwordInput.parentNode.appendChild(strengthText);
    
    function checkPasswordStrength(password) {
        let strength = 0;
        const bar = strengthBar.querySelector('.strength-bar');
        
        // –î–ª–∏–Ω–∞ –ø–∞—Ä–æ–ª—è
        if (password.length >= 8) strength += 1;
        if (password.length >= 12) strength += 1;
        
        // –ù–∞–ª–∏—á–∏–µ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–∏–º–≤–æ–ª–æ–≤
        if (/[a-z]/.test(password)) strength += 1;
        if (/[A-Z]/.test(password)) strength += 1;
        if (/[0-9]/.test(password)) strength += 1;
        if (/[^a-zA-Z0-9]/.test(password)) strength += 1;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
        bar.className = 'strength-bar';
        if (password.length === 0) {
            strengthText.textContent = '';
            bar.style.width = '0%';
        } else if (strength <= 2) {
            bar.classList.add('strength-weak');
            strengthText.textContent = '–°–ª–∞–±—ã–π –ø–∞—Ä–æ–ª—å';
            strengthText.style.color = '#ef4444';
        } else if (strength <= 4) {
            bar.classList.add('strength-medium');
            strengthText.textContent = '–°—Ä–µ–¥–Ω–∏–π –ø–∞—Ä–æ–ª—å';
            strengthText.style.color = '#f59e0b';
        } else if (strength <= 6) {
            bar.classList.add('strength-strong');
            strengthText.textContent = '–•–æ—Ä–æ—à–∏–π –ø–∞—Ä–æ–ª—å';
            strengthText.style.color = '#10b981';
        } else {
            bar.classList.add('strength-very-strong');
            strengthText.textContent = '–û—Ç–ª–∏—á–Ω—ã–π –ø–∞—Ä–æ–ª—å!';
            strengthText.style.color = '#059669';
        }
    }
    
    passwordInput.addEventListener('input', function() {
        checkPasswordStrength(this.value);
    });
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π
    const confirmInput = document.getElementById('id_new_password2');
    confirmInput.addEventListener('input', function() {
        const password = passwordInput.value;
        const confirm = this.value;
        
        if (confirm.length > 0) {
            if (password === confirm) {
                this.style.borderColor = '#10b981';
            } else {
                this.style.borderColor = '#ef4444';
            }
        }
    });
});
</script>
{% endblock %}