{% extends 'tasks/base.html' %}

{% block title %}–í—ã–ø–ª–∞—Ç–∞ - TaskManager{% endblock %}

{% block content %}
<div style="max-width: 500px; margin: 0 auto;">
    <div class="card">
        <h2>üí∏ –í—ã–ø–ª–∞—Ç–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É</h2>
        
        <form method="post">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="id_employee">–°–æ—Ç—Ä—É–¥–Ω–∏–∫:</label>
                {{ form.employee }}
            </div>
            
            <div class="form-group">
                <label for="id_amount">–°—É–º–º–∞ –≤—ã–ø–ª–∞—Ç—ã (—Ä—É–±.):</label>
                {{ form.amount }}
                <small style="color: var(--secondary);">–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: <span id="employee-balance">0</span> —Ä—É–±.</small>
            </div>
            
            <div class="form-group">
                <label for="id_description">–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</label>
                {{ form.description }}
            </div>
            
            <button type="submit" class="btn btn-primary" style="width: 100%;">üí≥ –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—ã–ø–ª–∞—Ç—É</button>
            <a href="{% url 'dashboard' %}" class="btn" style="width: 100%; margin-top: 0.5rem; background: var(--border);">–û—Ç–º–µ–Ω–∞</a>
        </form>
    </div>
</div>

<script>
    // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
    document.getElementById('id_employee').addEventListener('change', function() {
        const employeeId = this.value;
        if (employeeId) {
            fetch(`/api/employee-balance/${employeeId}/`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('employee-balance').textContent = data.balance;
                });
        }
    });
</script>
{% endblock %}