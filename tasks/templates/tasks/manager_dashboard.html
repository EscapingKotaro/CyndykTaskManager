{% extends 'tasks/base.html' %}

{% block title %}–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª—è—é—â–µ–≥–æ - TaskManager{% endblock %}

{% block content %}
<div class="card">
    <h1>üë®‚Äçüíº –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª—è—é—â–µ–≥–æ</h1>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin: 2rem 0;">
        <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 1.5rem; border-radius: 10px;">
            <h3>üë• –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</h3>
            <p style="font-size: 2rem; margin: 0.5rem 0;">{{ subordinates.count }}</p>
        </div>
        <div style="background: linear-gradient(135deg, #f093fb, #f5576c); color: white; padding: 1.5rem; border-radius: 10px;">
            <h3>üìã –í—Å–µ–≥–æ –∑–∞–¥–∞—á</h3>
            <p style="font-size: 2rem; margin: 0.5rem 0;">{{ tasks.count }}</p>
        </div>
        <div style="background: linear-gradient(135deg, #4facfe, #00f2fe); color: white; padding: 1.5rem; border-radius: 10px;">
            <h3>‚è≥ –ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</h3>
            <p style="font-size: 2rem; margin: 0.5rem 0;">{{ tasks|length }}</p>
        </div>
         <div style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 1.5rem; border-radius: 10px;">
            <h3>üí∏ –û–±—â–∏–π –¥–æ–ª–≥</h3>
        <p style="font-size: 2rem; margin: 0.5rem 0;">{{ total_debt }} —Ä—É–±.</p>
    </div>
    </div>

    <div style="display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap;">
        <a href="{% url 'create_employee' %}" class="btn btn-primary">üë• –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</a>
        <a href="{% url 'create_task' %}" class="btn btn-primary">‚ûï –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É</a>   
        <a href="{% url 'make_payment' %}" class="btn btn-success">üí≥ –í—ã–ø–ª–∞—Ç–∞</a>
        <a href="{% url 'payment_history' %}" class="btn btn-secondary">üìä –ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø–ª–∞—Ç</a>
        <a href="{% url 'calendar' %}"  class="btn btn-secondary">üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å</a>
        </div>
</div>

<div class="card">
    <h2>üë• –ú–æ–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</h2>
    <div style="overflow-x: auto;">
        <table class="table">
            <thead>
                <tr>
                    <th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th>
                    <th>Email</th>
                    <th>–ë–∞–ª–∞–Ω—Å</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for emp in subordinates %}
                <tr>
                    <td>
                        <strong>{{ emp.get_full_name|default:emp.username }}</strong>
                    </td>
                    <td>{{ emp.email }}</td>
                    <td>
                        <span class="balance">{{ emp.balance }} —Ä—É–±.</span>
                    </td>
                    <td>
                        
                        <a href="{% url 'delete_employee' emp.id %}" class="btn btn-danger" style="padding: 0.3rem 0.8rem; font-size: 0.9rem;">
                            üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="card">
    <h2>üìã –í—Å–µ –∑–∞–¥–∞—á–∏</h2>
    <div style="overflow-x: auto;">
        <table class="table">
            <thead>
                <tr>
                    <th>–ó–∞–¥–∞—á–∞</th>
                    <th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th>
                    <th>–°—Ä–æ–∫</th>
                    <th>–í–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for task in tasks %}
                <tr>
                    <td>
                        <strong>{{ task.title }}</strong>
                        <br><small style="color: var(--secondary);">{{ task.description|truncatewords:10 }}</small>
                    </td>
                    <td>{{ task.assigned_to.get_full_name|default:task.assigned_to.username }}</td>
                    <td>{{ task.due_date }}</td>
                    <td>{{ task.payment_amount }} —Ä—É–±.</td>
                    <td>
                        <span class="status-badge status-{{ task.status }}">
                            {{ task.get_status_display }}
                        </span>
                    </td>
                    <td>
                        {% if task.status == 'submitted' %}
                            <a href="{% url 'complete_task' task.id %}" class="btn btn-success" style="padding: 0.3rem 0.8rem; font-size: 0.9rem;">
                                ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
                            </a>
                        {% else %}
                            <span style="color: var(--secondary);">‚Äî</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}