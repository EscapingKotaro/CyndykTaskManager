{% extends 'tasks/base.html' %}

{% block title %}Панель управляющего - Менеджер задач{% endblock %}
{% block header %}Панель управляющего{% endblock %}

{% block content %}
<h2>Мои сотрудники ({{ subordinates.count }})</h2>
<table style="width: 100%; border-collapse: collapse;">
    <thead>
        <tr style="background: #f8f9fa;">
            <th style="padding: 10px; border: 1px solid #ddd;">Сотрудник</th>
            <th style="padding: 10px; border: 1px solid #ddd;">Баланс</th>
            <th style="padding: 10px; border: 1px solid #ddd;">Действия</th>
        </tr>
    </thead>
    <tbody>
        {% for emp in subordinates %}
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd;">{{ emp.get_full_name|default:emp.username }}</td>
            <td style="padding: 10px; border: 1px solid #ddd;">{{ emp.balance }} руб.</td>
            <td style="padding: 10px; border: 1px solid #ddd;">
                <a href="{% url 'change_employee_password' emp.id %}">Сменить пароль</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<h2>Все задачи ({{ tasks.count }})</h2>
<ul>
{% for task in tasks %}
    <li style="margin-bottom: 10px; padding: 10px; background: #f8f9fa; border-radius: 3px;">
        <strong>{{ task.title }}</strong> - {{ task.assigned_to.get_full_name|default:task.assigned_to.username }} 
        (до {{ task.due_date }}) - {{ task.get_status_display }}
        - {{ task.payment_amount }} руб.
        {% if task.status == 'submitted' %}
            <a href="{% url 'complete_task' task.id %}" style="color: green;">Подтвердить выполнение</a>
        {% endif %}
    </li>
{% endfor %}
</ul>
{% endblock %}