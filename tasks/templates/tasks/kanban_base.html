{% extends 'tasks/base.html' %}

{% block title %}{{ page_title|default:"–ö–∞–Ω–±–∞–Ω" }} - TaskManager{% endblock %}

{% block content %}
<div class="kanban-header">
    {% block kanban_header %}
    <div class="card">
        <h1>{{ header_title|default:"üë®‚Äçüíª –ú–æ–∏ –∑–∞–¥–∞—á–∏" }}</h1>
        {% if show_balance and request.user.balance > 0 %}
        <div class="balance-card">
            <h3>üí∞ –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å</h3>
            <p class="balance-amount">{{ request.user.balance }} —Ä—É–±.</p>
        </div>
        {% endif %}
        
        {% if team_stats %}
        <div class="team-stats">
            <div class="stat-item">
                <span class="stat-label">üë• –ö–æ–º–∞–Ω–¥–∞:</span>
                <span class="stat-value">{{ team_stats.user_count }} —á–µ–ª.</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">üìã –ó–∞–¥–∞—á–∏:</span>
                <span class="stat-value">{{ team_stats.task_count }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">üí∞ –°—É–º–º–∞:</span>
                <span class="stat-value">{{ team_stats.total_payment }} —Ä—É–±.</span>
            </div>
        </div>
        {% endif %}
    </div>
    {% endblock %}
</div>

<div class="card">
    <h2>{{ board_title|default:"üìã –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏" }} ({{ total_tasks }})</h2>
    
    {% if total_tasks > 0 %}
    <div class="kanban-container">
        {% for status_code, group in status_groups.items %}
        {% if group.count > 0 or show_empty_columns %}
        <div class="kanban-column {% if group.count == 0 %}empty-column{% endif %}">
            <div class="column-header">
                <h3 class="column-title">{{ group.name }}</h3>
                <div class="column-stats">
                    <span class="task-count">{{ group.count }}</span>
                    {% if group.total_payment > 0 %}
                    <span class="payment-badge">üí∞ {{ group.total_payment }}</span>
                    {% endif %}
                </div>
            </div>
            
            <div class="tasks-container" data-status="{{ status_code }}">
                {% block task_list %}
                    {% for task in group.tasks %}
                    <div class="task-card" data-task-id="{{ task.id }}">
                        {% include 'tasks/partials/task_card.html' with task=task %}
                    </div>
                    {% endfor %}
                {% endblock %}
                
                {% if group.count == 0 and show_empty_columns %}
                <div class="empty-column-message">
                    <p>–ù–µ—Ç –∑–∞–¥–∞—á</p>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <p class="empty-icon">üéâ</p>
        <p class="empty-title">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á!</p>
        <p class="empty-subtitle">–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! –ù–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å.</p>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_css %}
<style>
.kanban-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    align-items: start;
}

.kanban-column {
    background: var(--background);
    border-radius: 10px;
    padding: 1rem;
    min-height: 400px;
}

.kanban-column.empty-column {
    opacity: 0.6;
}

.column-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--border);
}

.column-title {
    font-size: 1.1rem;
    font-weight: 600;
    margin: 0;
    color: var(--primary);
}

.column-stats {
    display: flex;
    gap: 0.5rem;
    align-items: center;
}

.task-count {
    background: var(--primary);
    color: white;
    padding: 0.2rem 0.6rem;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 600;
}

.payment-badge {
    background: #10b981;
    color: white;
    padding: 0.2rem 0.6rem;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 600;
}

.tasks-container {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    min-height: 100px;
}

.task-card {
    background: white;
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1rem;
    transition: all 0.2s ease;
}

.task-card:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    transform: translateY(-2px);
}

.balance-card {
    background: linear-gradient(135deg, #10b981, #059669);
    color: white;
    padding: 1.5rem;
    border-radius: 10px;
    margin: 1rem 0;
    max-width: 300px;
}

.balance-amount {
    font-size: 2rem;
    margin: 0.5rem 0;
    font-weight: bold;
}

.team-stats {
    display: flex;
    gap: 2rem;
    margin-top: 1rem;
    flex-wrap: wrap;
}

.stat-item {
    display: flex;
    flex-direction: column;
    gap: 0.3rem;
}

.stat-label {
    font-size: 0.9rem;
    color: var(--secondary);
}

.stat-value {
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--primary);
}

.empty-state {
    text-align: center;
    padding: 3rem;
    color: var(--secondary);
}

.empty-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
}

.empty-title {
    font-size: 1.2rem;
    margin-bottom: 0.5rem;
}

.empty-column-message {
    text-align: center;
    padding: 2rem;
    color: var(--secondary);
    font-style: italic;
}

/* –°—Ç–∞—Ç—É—Å-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å—Ç–∏–ª–∏ –∫–æ–ª–æ–Ω–æ–∫ */
.tasks-container[data-status="proposed"] {
    border-left: 4px solid #fbbf24;
}

.tasks-container[data-status="created"] {
    border-left: 4px solid #10b981;
}

.tasks-container[data-status="in_progress"] {
    border-left: 4px solid #3b82f6;
}

.tasks-container[data-status="submitted"] {
    border-left: 4px solid #f59e0b;
}

.tasks-container[data-status="completed"] {
    border-left: 4px solid #059669;
}

@media (max-width: 768px) {
    .kanban-container {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}